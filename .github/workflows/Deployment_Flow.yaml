name: Deploy to Railway and Submit Slack Notification
on:
  push:
    branches:
    - 'release/v*.*'
    - '!*-*'
    comments:
    - '!#NORUN'

jobs:
  DeploymenFlow:
    runs-on: ubuntu-latest
    steps:
      
      - name: Deploy app to railway
        uses: bervProject/railway-deploy@main
        with:
          railway_token: ${{ secrets.RAILWAY_TOKEN }}
          service: "avid-root"

      - name: Send block message to slack
        id: slack
        uses: slackapi/slack-github-action@v1.23.0
        with:
          payload-file-path: "./home/runner/work/GDipSA_SA4101_ADLC3_CA/payload-slack-content.json"
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.PERSONAL_SLACK_WEBHOOK_URL }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK